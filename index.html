<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8" />
  <title>Drift State</title>
  <meta name="viewport" content="width=device-width, initial-scale=1.0" />

  <link href="https://fonts.googleapis.com/css2?family=UnifrakturCook:wght@700&display=swap" rel="stylesheet">

  <style>
    * { box-sizing: border-box; }

    body {
      margin: 0;
      background: #000;
      color: #fff;
      font-family: Arial, sans-serif;
    }

    /* HERO */
    .hero {
      min-height: 100vh;
      display: flex;
      align-items: center;
      justify-content: center;
      text-align: center;
      padding: 2rem;
    }
    .brand { max-width: 780px; }

    /* REAL 3D (optional) container */
    .logo3d-wrap {
      width: 260px;
      height: 260px;
      margin: 0 auto 1.25rem;
      background: transparent;
      display: grid;
      place-items: center;
      position: relative;
    }

    /* Fallback image is ALWAYS visible by default */
    .fallback-img {
      width: 220px;
      height: 220px;
      object-fit: contain;
      display: block;               /* IMPORTANT: visible by default */
      background: transparent;
      filter: grayscale(100%) brightness(1.35) contrast(1.45)
        drop-shadow(0 0 18px rgba(255,255,255,0.35));
      pointer-events: none;         /* never blocks clicks */
    }

    /* Canvas is hidden by default; only shown if 3D starts successfully */
    .logo3d-canvas {
      width: 100%;
      height: 100%;
      display: none;                /* IMPORTANT: hidden by default */
      background: transparent;
      pointer-events: none;         /* never blocks clicks */
      position: absolute;
      inset: 0;
    }

    .brand-name {
      font-family: 'UnifrakturCook', cursive;
      font-size: 4rem;
      letter-spacing: 6px;
      margin: 0.5rem 0;
    }
    .tagline {
      letter-spacing: 3px;
      opacity: 0.7;
    }

    /* DECALS */
    .decals-section {
      padding: 5rem 2rem;
      position: relative;
      z-index: 1;
    }
    .section-title {
      text-align: center;
      font-size: 2.5rem;
      letter-spacing: 6px;
      margin-bottom: 3rem;
    }
    .decals-grid {
      display: grid;
      grid-template-columns: repeat(auto-fit, minmax(260px, 1fr));
      gap: 2rem;
      max-width: 1100px;
      margin: 0 auto;
    }
    .decal-card {
      border: 1px solid rgba(255,255,255,0.25);
      padding: 1.5rem;
      text-align: center;
      cursor: pointer;
      transition: transform 0.25s ease, box-shadow 0.25s ease;
      background: #000;
    }
    .decal-card:hover {
      transform: translateY(-6px);
      box-shadow: 0 0 30px rgba(255,255,255,0.15);
    }
    .decal-image {
      width: 100%;
      aspect-ratio: 1 / 1;
      background: #fff; /* placeholder white square */
      margin-bottom: 1rem;
    }
    .decal-name { letter-spacing: 2px; margin-bottom: 0.3rem; }
    .decal-price { opacity: 0.8; }

    /* MODAL (cannot block clicks when closed) */
    .modal {
      position: fixed;
      inset: 0;
      background: rgba(0,0,0,0.95);
      display: flex;
      justify-content: center;
      align-items: flex-start;
      padding: 2rem 1rem;
      z-index: 999;

      opacity: 0;
      pointer-events: none;
      transition: opacity 0.2s ease;
    }
    .modal.active {
      opacity: 1;
      pointer-events: auto;
    }
    .modal-content {
      max-width: 640px;
      width: 100%;
      text-align: center;
    }
    .modal h2 { margin: 0.75rem 0 0.35rem; letter-spacing: 3px; }
    .modal p { margin: 0.25rem 0; opacity: 0.85; }

    .color-options { margin-top: 1.25rem; }
    .color-options span {
      display: inline-block;
      border: 1px solid #fff;
      padding: 0.45rem 0.9rem;
      margin: 0.35rem;
      cursor: pointer;
      opacity: 0.7;
      user-select: none;
    }
    .color-options span.active {
      background: #fff;
      color: #000;
      opacity: 1;
    }

    .close {
      margin-top: 2rem;
      cursor: pointer;
      opacity: 0.6;
      display: inline-block;
      padding: 0.6rem 1rem;
      border: 1px solid rgba(255,255,255,0.25);
    }
    .close:hover { opacity: 1; }

    footer {
      text-align: center;
      padding: 2rem;
      opacity: 0.6;
    }
    footer a { color:#fff; text-decoration:none; }
    footer a:hover { text-decoration:underline; }
  </style>
</head>

<body>

  <!-- HERO -->
  <section class="hero">
    <div class="brand">

      <!-- Logo: ALWAYS shows image. 3D spins on top if it loads. -->
      <div class="logo3d-wrap">
        <img src="ds-logo.png" alt="DS Logo" class="fallback-img" id="fallbackHero">
        <canvas id="logo3dHero" class="logo3d-canvas"></canvas>
      </div>

      <div class="brand-name">DRIFT STATE</div>
      <div class="tagline">GOTHIC • STREET • GRUNGE</div>
    </div>
  </section>

  <!-- DECALS -->
  <section class="decals-section">
    <div class="section-title">DECALS</div>

    <div class="decals-grid">
      <div class="decal-card" onclick="openModal('DS Corner Banner','$45.00 CAD','16&quot; × 8&quot;')">
        <div class="decal-image"></div>
        <div class="decal-name">DS Corner Banner</div>
        <div class="decal-price">$45.00 CAD</div>
      </div>

      <div class="decal-card" onclick="openModal('DS Cursive Banner','$55.00 CAD','36&quot; × 5&quot;')">
        <div class="decal-image"></div>
        <div class="decal-name">DS Cursive Banner</div>
        <div class="decal-price">$55.00 CAD</div>
      </div>

      <div class="decal-card" onclick="openModal('DS Grunge Banner','$50.00 CAD','21&quot; × 9&quot;')">
        <div class="decal-image"></div>
        <div class="decal-name">DS Grunge Banner</div>
        <div class="decal-price">$50.00 CAD</div>
      </div>

      <div class="decal-card" onclick="openModal('DS Gothic Banner','$55.00 CAD','32&quot; × 4&quot;')">
        <div class="decal-image"></div>
        <div class="decal-name">DS Gothic Banner</div>
        <div class="decal-price">$55.00 CAD</div>
      </div>
    </div>
  </section>

  <!-- MODAL -->
  <div class="modal" id="productModal" onclick="if(event.target.id==='productModal')closeModal()">
    <div class="modal-content">

      <div class="logo3d-wrap" style="width:230px;height:230px;margin-top:0.25rem;">
        <img src="ds-logo.png" alt="DS Logo" class="fallback-img" id="fallbackModal" style="width:200px;height:200px;">
        <canvas id="logo3dModal" class="logo3d-canvas"></canvas>
      </div>

      <h2 id="modalTitle"></h2>
      <p id="modalPrice"></p>
      <p id="modalSize"></p>

      <div class="color-options" id="colorOptions">
        <span onclick="selectColor(this)">Black</span>
        <span onclick="selectColor(this)">White</span>
        <span onclick="selectColor(this)">Silver</span>
      </div>

      <div class="close" onclick="closeModal()">Close</div>
    </div>
  </div>

  <footer>
    <div><a href="mailto:volzmain05@gmail.com">volzmain05@gmail.com</a></div>
    <div>© Drift State</div>
  </footer>

  <!-- Modal + colors -->
  <script>
    let selectedColor = null;

    function openModal(name, price, size) {
      document.getElementById('modalTitle').innerText = name;
      document.getElementById('modalPrice').innerText = price;
      document.getElementById('modalSize').innerText = "Size: " + size;

      selectedColor = null;
      document.querySelectorAll('#colorOptions span').forEach(s => s.classList.remove('active'));

      document.getElementById('productModal').classList.add('active');
    }

    function closeModal() {
      document.getElementById('productModal').classList.remove('active');
    }

    function selectColor(el) {
      document.querySelectorAll('#colorOptions span').forEach(s => s.classList.remove('active'));
      el.classList.add('active');
      selectedColor = el.innerText;
    }
  </script>

  <!-- Optional REAL 3D layer (WebGL). If it fails, your image still shows. -->
  <script type="module">
    const LOGO_SRC = "ds-logo.png";

    async function start3D(canvasId, fallbackId) {
      const canvas = document.getElementById(canvasId);
      const fallback = document.getElementById(fallbackId);
      if (!canvas || !fallback) return;

      // If WebGL isn't supported, keep the image (fallback) visible.
      const gl = canvas.getContext("webgl2") || canvas.getContext("webgl");
      if (!gl) return;

      let THREE, RoomEnvironment;
      try {
        THREE = await import("https://unpkg.com/three@0.161.0/build/three.module.js");
        ({ RoomEnvironment } = await import("https://unpkg.com/three@0.161.0/examples/jsm/environments/RoomEnvironment.js"));
      } catch (e) {
        // If CDN is blocked / offline, keep fallback image.
        return;
      }

      // Show canvas only AFTER we successfully init Three.js
      canvas.style.display = "block";

      const renderer = new THREE.WebGLRenderer({
        canvas,
        alpha: true,
        antialias: true,
        powerPreference: "high-performance"
      });
      renderer.setPixelRatio(Math.min(window.devicePixelRatio || 1, 2));
      renderer.setClearColor(0x000000, 0);

      const scene = new THREE.Scene();

      const camera = new THREE.PerspectiveCamera(35, 1, 0.1, 100);
      camera.position.set(0, 0.2, 4);

      const key = new THREE.DirectionalLight(0xffffff, 2.2);
      key.position.set(3, 4, 5);
      scene.add(key);

      const fill = new THREE.DirectionalLight(0xffffff, 0.9);
      fill.position.set(-3, 1, 4);
      scene.add(fill);

      const rim = new THREE.DirectionalLight(0xffffff, 1.2);
      rim.position.set(0, 3, -5);
      scene.add(rim);

      const pmrem = new THREE.PMREMGenerator(renderer);
      const envTex = pmrem.fromScene(new RoomEnvironment(renderer), 0.04).texture;
      scene.environment = envTex;

      const group = new THREE.Group();
      scene.add(group);

      const chrome = new THREE.MeshPhysicalMaterial({
        color: 0xffffff,
        metalness: 1,
        roughness: 0.08,
        clearcoat: 1,
        clearcoatRoughness: 0.08,
        envMapIntensity: 1.6
      });

      // Coin body
      const baseGeo = new THREE.CylinderGeometry(1.2, 1.2, 0.22, 64, 1, true);
      const base = new THREE.Mesh(baseGeo, chrome);
      base.rotation.x = Math.PI / 2;
      group.add(base);

      // Logo texture faces
      const loader = new THREE.TextureLoader();
      let logoTex;
      try {
        logoTex = await new Promise((resolve, reject) => {
          loader.load(
            LOGO_SRC,
            t => resolve(t),
            undefined,
            e => reject(e)
          );
        });
      } catch (e) {
        // If image fails to load, hide canvas and keep fallback.
        canvas.style.display = "none";
        return;
      }

      logoTex.colorSpace = THREE.SRGBColorSpace;

      const faceMat = new THREE.MeshPhysicalMaterial({
        color: 0xffffff,
        metalness: 1,
        roughness: 0.12,
        clearcoat: 1,
        clearcoatRoughness: 0.12,
        envMapIntensity: 1.8,
        map: logoTex,
        transparent: true,
        alphaTest: 0.35
      });

      const plateGeo = new THREE.CircleGeometry(1.12, 64);

      const front = new THREE.Mesh(plateGeo, faceMat);
      front.position.z = 0.12;
      group.add(front);

      const back = new THREE.Mesh(plateGeo, faceMat);
      back.rotation.y = Math.PI;
      back.position.z = -0.12;
      group.add(back);

      // Bevel ring
      const ringGeo = new THREE.TorusGeometry(1.18, 0.04, 16, 100);
      const ring = new THREE.Mesh(ringGeo, chrome);
      ring.rotation.x = Math.PI / 2;
      group.add(ring);

      group.rotation.x = 0.25;
      group.rotation.y = 0.25;

      function resize() {
        const rect = canvas.getBoundingClientRect();
        const w = Math.max(1, Math.floor(rect.width));
        const h = Math.max(1, Math.floor(rect.height));
        renderer.setSize(w, h, false);
        camera.aspect = w / h;
        camera.updateProjectionMatrix();
      }
      resize();

      const ro = new ResizeObserver(resize);
      ro.observe(canvas);

      // Hide fallback ONLY after everything is running
      fallback.style.visibility = "hidden";

      let alive = true;
      function animate() {
        if (!alive) return;
        group.rotation.y += 0.01;
        renderer.render(scene, camera);
        requestAnimationFrame(animate);
      }
      animate();

      // If the tab becomes inactive, Three can still run fine; leaving it simple.
    }

    // Start 3D on both canvases; fallback image will remain if anything fails.
    start3D("logo3dHero", "fallbackHero");
    start3D("logo3dModal", "fallbackModal");
  </script>

</body>
</html>
